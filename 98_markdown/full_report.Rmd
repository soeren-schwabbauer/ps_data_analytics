---
title: "Proseminar Data Analytics - Group: Romania"
author: "Sören Schwabbauer, David Hollenstein, Alexander Hanser, Jürgen Bildstein"
date: "2022-10-25"
output: 
  html_document: 
    number_sections: true
    css: style.css
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# load libraries
library(knitr)
library(dplyr)
library(haven)
library(ggplot2)
library(ggmosaic)
library(lazyeval)
library(gridExtra)
library(ggmosaic)
library(lemon)


if (dir.exists("G:/Geteilte Ablagen/")) {
  
  INPUT = "G:/Geteilte Ablagen/data_analytics/01_data_build/OUTPUT/"
  
} else if (dir.exists("G:/Shared drives/")) {
  
  INPUT = "G:/Shared drives/data_analytics/01_data_build/OUTPUT/"
  
}

# load dataframe
load(paste0(INPUT, "Romania.rda"))

```


```{r functions & plots for task 2 , echo = FALSE, out.width="100%"}
##### define themes and create functions for plotting ##########################

# define theme for mosaic ######################################################
mosaic_theme <-   theme( 
  #legend.position = "none",
  axis.title.x = element_blank(),
  axis.title.y = element_blank(),
  axis.text.x = element_text(angle=90, size = 7),
  axis.text.y = element_text(size = 7),
  panel.background = element_rect(fill = "white"),
  panel.grid.major.y = element_line(size = 0, linetype = 'solid',
                                    colour = "white") ,
  legend.position = "none",
  plot.title = element_text(color="black", size= 8, face="bold.italic", vjust = 0.5)
) 

  
# define function, incl. theme for barplots ####################################

barplot_var <- function(var){
  romania %>%
    ggplot(aes(x= {{var}}, y= ..count.. , fill = {{var}})) +
    geom_bar() +
    labs(x = "",
         y = "total number") +
    geom_text(stat = "count", aes(label= paste0(..count.., " (", round(..count../nrow(romania),4)*100 , "%)")), vjust = -0.5, size = 3) +
  
    theme(
      legend.position = "none",
      axis.title.x = element_blank(),
      panel.background = element_rect(fill = "white"),
      panel.grid.major.y = element_line(size = 0.5, linetype = 'solid',
                                        colour = "grey") ,
      plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5)
      
    )
}


boxplot_for_barplot <- function(var){
  romania %>%
    ggplot(aes(y = as.numeric({{var}}))) +
    geom_boxplot(width = 0.5) +
    coord_flip() +
    
    theme(
      axis.title.x = element_blank(),
      axis.text.x = element_blank(),
      axis.ticks.x = element_blank(),
      axis.title.y = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks.y = element_blank(),
      panel.background = element_rect(fill = "white"),
      panel.grid.major.y = element_line(size = 0.5, linetype = 'solid',
                                        colour = "white"),
      plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5)
    ) 
}

boxplot_age <- function(var1, var2, var3){
  romania %>% 
    ggplot(aes(x = {{var1}}, y = {{var2}})) +
    geom_boxplot(aes(fill = {{var3}})) +
    
    theme(
      axis.title.x = element_blank(),
      axis.text.x = element_text(angle=90),
      axis.ticks.x = element_blank(),
      #axis.title.y = element_blank(),
      #axis.text.y = element_blank(),
      #axis.ticks.y = element_blank(),
      panel.background = element_rect(fill = "white"),
      panel.grid.major.y = element_line(size = 0.5, linetype = 'solid',
                                        colour = "grey"),
      plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5)
      
    ) +
    scale_y_continuous(breaks = c(10, 20, 30, 40, 50, 60, 70, 80))
}

```

```{r functions & plots for task 3 , echo = FALSE, out.width="100%"}
### function for impact of the level of trust on 
trust_var_summary <- function(var, var_char){
  romania %>% select(trust_fac, {{var}}) %>% rename(member = {{var}}) %>% mutate(cat = {{var_char}}) %>%
    group_by(member, cat, trust_fac) %>%
    summarise(n = n()) %>%
    mutate(prop = n/sum(n)) 
}


### function + plot for general membership
ties_var_summary <- function(var, var_char){
  romania %>% select({{var}},contains("member_")) %>% rename(member = {{var}}) %>% melt() %>%
    group_by(value, member) %>%
    summarise(n = n()) %>%
    mutate(prop = n/sum(n)) %>%
    
    mutate(value = replace(value, value == 1, "member"),
           value = replace(value, value == 0, "no member"),
           value = as_factor(value)) %>%
    
    ggplot(aes(x = (value), y = prop, fill = as_factor(member))) +
    geom_bar(stat = "identity") +
    labs(y = "Distribution (%)") + 
    theme(
      axis.title.x = element_blank(),
      axis.text.x = element_text(angle=0),
      #axis.title.y = element_blank(),
      panel.background = element_rect(fill = "white"),
      panel.grid.major.y = element_line(size = 0, linetype = 'solid',
                                        colour = "grey") ,
      plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5) ,
      plot.subtitle = element_text(color = "black", size = 10, face = "italic")
      
    ) +
    
    scale_y_continuous(labels = scales::percent,
                       breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) 
}

### function for each membership & type of neighbor + theme for the plots
fun_happy <- function(cat, var, var_char){
  romania %>% select({{cat}}, {{var}}) %>% rename(member = {{var}}) %>% mutate(cat = {{var_char}}) %>%
    
    mutate(member = as.character(as_factor(member)),
           member = replace(member, member == "Mentioned", "yes"),
           member = replace(member, member == "Not mentioned", "no"))
}

theme_cat <-   theme(
  axis.title.x = element_blank(),
  axis.text.x = element_text(angle=0),
  #axis.title.y = element_blank(),
  panel.background = element_rect(fill = "white"),
  panel.grid.major.y = element_line(size = 0, linetype = 'solid',
                                    colour = "grey") ,
  plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5) 
)

```

# Download data
>  Download the data for the country you choose. You also find the official variable description file in the corresponding folder.

Done.

___
# First overview of data
> Get acquainted with the data (rename and/or recode variables). The main variables with which we are going to work are measures of subjective well-being (SWB), namely general happiness and life satisfaction. Are these two variables comparable measures of SWB? How do these variables correlate with personal characteristics like income, health, age, marital status, etc.? Find suitable ways to show some possible (not necessarily causal) relationships.

## A170 satisfaction in life
```{r , echo = FALSE, out.width="100%"}
 summary(romania$satisfaction)

```
The summary command allows us to have a rough overview of the variable A170 - satisfaction in life. The variable is scaled from 1 to 10, with 10 being the highest level of satisfaction. Since one can rank the level of satisfaction (e.g: a level of 8 being higher ranked than a level 2), but the distance between the levels is subjective (e.g: a person on a level 8 is not necessarily twice as happy as a person on the level 4) Life satisfaction can be considered an ordinarily scaled variable. 
The summary command shows, that everybody has replied to to questions (no NA's). Another conclusion which can be drawn from the summary command is the average level of satisfaction. With a median level of 8, and a mean of 7.5, the Romanian people are generally not extremely satisfied, but also not unsatisfied with their life as a whole. In addition to that, it can be seen, that the half of the asked population ranks themselves between a 6 and a 9.

The following plot allows a look at the distribution of satisfaction
```{r , echo = FALSE, out.width="100%"}
bar_satiscation <- barplot_var(satisfaction_fac) 

box_satiscation <- boxplot_for_barplot(satisfaction) +
  labs(title = "Overall life satisfaction") 

grid.arrange(box_satiscation, bar_satiscation, nrow = 2, heights = c(0.5,2))
```
The barplot on the distribution of satisfaction in life adds additional information to the summary command. As one can see, most people can identify with the highest level "satisfied" . It remains unclear, why there is such a rapid drop one level below. Furthermore it can be seen, that the lower 25% are much more distributed (from 2 to 5), whereas "Satisfied" contains all the upper 25% of the counts. 

## A008 Feeling of happiness
```{r , echo = FALSE, out.width="100%"}
summary(romania$happy)
```
Also the variable happy only contains interpretable values. Neither has nobody not answered, nor has the question being skipped, or other other problems occurred. The variable is scaled from 1 to 4. 1 indicates "very happy", 4 indicates "not at all happy". Identical to satisfaction, the feeling of happiness counts as a originally scaled variable.

The following barplot allows a closer look at the distribution of happiness within # the questioned people in Romania
```{r , echo=FALSE, out.width="100%"}
barplot_var(happy_fac) +
  labs(title = "Overall feeling of happiness")
```
From the barplot one can conclude, that most people (approx. 56%) are "quite happy", one fifth of the questioned population are "very happy" and roughly the same amount of people are "not very happy", or "not at all happy"


## Univariate and multivariate analysis of SWB Factors
In the following section we are going to provide a comparison of the two key variables with other variables. 

### Income
```{r , echo = FALSE, out.width="100%"}
summary(romania$income_scale)
```
The variable income was evaluated by showing the questioned households a range of income groups within their country, of which the participants had to select one. The income then got scaled from 1 (the 1st decile) and 10 (the highest decile).

The following two plots allow an insight in the income distribution of Romania
```{r , echo = FALSE, out.width="100%"}

bar_income <- barplot_var(income_scale_fac) +
    theme(axis.text.x = element_text(angle=90))

box_income <- boxplot_for_barplot(income_scale) +
  labs(title = "Income distribution") 

grid.arrange(box_income, bar_income, nrow = 2, heights = c(0.5,2))
```
It can be seen, that the distribution is right skewed. This indicates, that the vast majority belongs to a lower income group. The boxplot shows, that 50% of the people lay in between the 3rd and the 5th decile.

The following mosaic plots shall provide an overview of the two main variables and the scaled income.
```{r , echo = FALSE, out.width="100%"}
inc_happy <-  romania %>%
  ggplot() +
  geom_mosaic(aes(x =  product(happy_fac, income_scale_fac), fill = happy_fac)) +
  
  labs(title ="Comparison of happiness in life and income",
       fill = "Scale of happiness") +
  mosaic_theme
  
inc_satis <- romania %>%
  ggplot() +
  geom_mosaic(aes(x =  product(satisfaction_group, income_scale_fac), fill = satisfaction_group)) +
  
  labs(title ="Comparison of satisfaction in life and income",
       fill = "Scale of satisfaction") +
  mosaic_theme

grid.arrange(inc_happy, inc_satis, nrow = 1)
```
The two mosaic plots allow a bivariate exploratory analysis among the variables income and happiness, as well as income and satisfaction. The comparison between income and satisfaction in life shows, that the group with the lowest income is the group has more "very happy" people, than the following 3 decile's. However by grouping "quite happy" and "very happy" into one category, as suggested by the second decile, it can then be seen that the lower three deciles make up for the lowest share. When analyzing the top 30% of income earners, we can see that almost everybody is at least "quite happy". Also worth noting is that the top decile group of earners has less "very happy" people as decile group 7,8 & 9.

For a better overview, we grouped the levels of satisfaction into 1 = "Not satisfied at all, 2-5 = "not very satisfied", 6-9 = "quiet satisfied" and 10  = very satisfied.Comparing the satisfaction and the income, the group with the lowest income, again has one of the highest rates of satisfaction. Tough it should also be mentioned, that they also share one of the highest rates of Dissatisfaction. Once again it shows, that a higher income rules out the chance of being "not satisfied at all". At the same time, the top 10% income group accounts for the lowest amount of very satisfied people. 


### Health
```{r , echo=FALSE, out.width="100%"}
bar_health <- barplot_var(health_fac) 

box_health <- boxplot_for_barplot(health) +
  labs(title = "Health distribution")

grid.arrange(box_health, bar_health, nrow = 2, heights = c(0.5,2))
```
The average citizen seems to be in rather good health condition. Most of the answers group around the "good" health answer. The second most frequent answer is the "fair" health response. A very small percentage of respondents report being of "poor" or "very poor" health. 

```{r , echo=FALSE, out.width="100%"}
health_happy <-  romania %>%
  ggplot() +
  geom_mosaic(aes(x =  product(happy_fac, health_fac), fill = happy_fac)) +
  
  labs(title ="Comparison of happiness in life and health",
       fill = "Scale of happiness") +
  mosaic_theme

health_satis <- romania %>%
  
  ggplot() +
  geom_mosaic(aes(x =  product(satisfaction_group, health_fac), fill = satisfaction_group)) +
  
  labs(title ="Comparison of satisfaction in life and health",
       fill = "Scale of happiness") +
  mosaic_theme

grid.arrange(health_happy, health_satis, nrow = 1)
```
These mosaic plots show a connection between health of an individual and the satisfaction with life and overall happiness. Looking at happiness in life first, what stands out is, that those with poor and very poor health are to a large extent not very happy. This also translates to overall life satisfaction. Those with poor health are to a large extent not very satisfied. The opposite to this observation also holds true. Those with good and very good health are to a very large extent either very happy or quite happy. Respectively, those with good and very good health are also quite satisfied and very satisfied.

### Age
```{r , echo=FALSE, out.width="100%"}
summary(romania$age)
```
The summary command tells us the mean and the median age. Bothe are around 50. With the mean and the median age laying close together, one can say, that  the distribution is rater equal. Since the age scaling end at the age of 82, one can not say, how old the oldest person in the dataframe is. The youngest however is at the age of 19.

In order to get a brief overview of the age distribution, a population pyramid can help.
```{r , echo=FALSE, out.width="100%"}
romania %>% 
  group_by(age, sex_fac) %>%
  summarize(n = n()) %>% 
  mutate(age = as.character(age),
         sex = as.character(sex_fac),
         n = as.integer(n)) %>%

  ggplot( mapping = aes(x = ifelse(test = sex_fac == "Male", yes = -n, no = n), 
                     y = age, fill = sex)) +
  geom_col() +
  scale_x_symmetric(labels = abs) +
  labs(x = "Population ",
       title = "Age distribution in the sample") +
  scale_y_discrete(breaks = c(19, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 82)) +
  
  theme(
    plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5),
    panel.background = element_rect(fill = "white"),
    panel.grid.major.y = element_line(size = 0.5, linetype = 'solid',
                                      colour = "grey") 
  )
```
The visualisation of age distribution separated by sex supports the insight, that there is no significant difference or trend in age distribution.

```{r , echo=FALSE, out.width="100%"}
boxplot_happy <- boxplot_age(happy_fac, age, sex_fac) +
  labs(title = "Range of age for the level of happiness",
       fill = "age") 

boxplot_satisfaction <- boxplot_age(satisfaction_fac, age, 0) +
  labs(title = "Range of age by satisfaction") +
  theme(legend.position = "none")


grid.arrange(boxplot_happy, boxplot_satisfaction, nrow = 1)
```
The boxplots show the distribution of age within the different levels of happiness and satisfaction. On the left graph it can be seen, that the median age increases, the less satisfied a person is. In the left graph it can be seen, that people who are "not happy at all" tend to be much older by median, than people who are very happy. For a less biased picture, we decided to split the level of happiness into male and female. It can be seen, that this does not make so big of a difference. However, a switch in the median age is observable, the less happy a person gets. The right boxplot shows that people with a satisfaction-level of 1 and 2 are almost solely over the age of 50. We can also note, that with satisfaction-levels of 3 and 4, the age is also quite high except for the lower 25 percentile in age and the lower outliers. Quite striking are the variances in the satisfaction-levels from 5 to 10, which span the whole age spectrum, although in general we can say that the higher the satisfaction-level the lower the median age

### Marital status
```{r , echo=FALSE, out.width="100%"}
barplot_var(marst_fac) +
  labs(title = "Marriage distribution")
```
Since it is not possible, to put the marital status in some kind of hierarchy, it can be considered a nominal scaled variable. The graph shows the distribution of people regarding their legal marital status. It can be seen, that the wide majority (60%) is married. The second and third highest population is formed by people who are single or have never been married (19%), and people who are widowed (15%).

The following mosaic plots are an attempt of a causal link between the marriage status, happiness and life satisfaction 
```{r , echo=FALSE, out.width="100%"}
romania %>%
  ggplot() +
  geom_mosaic(aes(x =  product(happy_fac, marst_fac), fill = happy_fac)) +
  
  labs(title ="Comparison of happiness in life and marital status",
       fill = "Scale of satisfaction") +
  mosaic_theme
```
It can be seen, that the widowed people are generally the ones who are rather not, or not happy at all. The single and married people are generally the biggest peopulation of people who are "very happy". 

```{r , echo=FALSE, out.width="100%"}
romania %>%
  ggplot() +
  geom_mosaic(aes(x =  product(satisfaction_group, marst_fac), fill = satisfaction_group)) +
  
  labs(title ="Comparison of satisfaction in life and marital status",
       fill = "Scale of satisfaction") +
  mosaic_theme
```
The distribution of "very satisified" people is quiet similar to the one seen in the previous plot. The same counts for the "not very" or "not satisfied at all", with widowed people making up the largest population.


### Additional variables
```{r , echo = FALSE, out.width="100%"}

activity_fun <- function(var, var_char){
  romania %>% select(happy, {{var}}) %>% rename(member = {{var}}) %>% mutate(cat = {{var_char}})
}

bind_rows( activity_fun(member_activity, "an activity"),
           activity_fun(member_religion, "a religion"),
           activity_fun(member_selfhelp, "a selfhelp group"),
           activity_fun(member_charity, "a charity"),
           activity_fun(member_labor_union, "a labor union")) %>%
  
  group_by(member, cat, happy) %>%
  summarize(n = n()) %>%
  mutate(perc = n/sum(n)) %>%
  
  ggplot(aes(x = as_factor(member), y = perc, fill = as_factor(happy))) +
  geom_bar(stat = "identity") +
  labs(fill = "Level of Happiness",
       y = "Distribution (%)",
       title = "Member of ...") +
  
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle=90),
    #axis.title.y = element_blank(),
    panel.background = element_rect(fill = "white"),
    panel.grid.major.y = element_line(size = 0, linetype = 'solid',
                                      colour = "grey") ,
    plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5) 
    
  ) +
  
  scale_y_continuous(labels = scales::percent,
                     breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) +
  
  facet_grid( ~ cat) 
```
These additional variables also allow a little bit of insight into the data. Starting off with charitable causes we can see that those who mentioned being a member of a charitable organisation reported to be quite happy or very happy more often. Being a member of a labor union also seems to have a certain connection to happiness as union members more often reported to be quite or very happy as opposed to non-members. Interestingly, being a member of a religious organisation doesn't seem to increase happiness for all participants. It can be observed that those who are religious more often reported to be not very happy but at the same time religious respondents more often reported to be very happy. One way of interpreting this would be to assume that being religious could have a diverging effect on people and either increase or decrease their happiness according to some other external variable. Looking at the variable of being a member of a self-help group, the graphs don't diverge as much as for other variables. Those who are members of a self-help group have a little more frequently reported to be quite happy than those who are not, but the effect is very small. Finally, being a member of an activity. This seems to be connected to the effect of happiness as those who have reported to be member of any sort of activity rarely mentioned to be not very happy or not at all happy. Over 90% of respondents who mentioned to be member of an activity reported to be either very or at least quite happy.


# Social Capital
> The literature shows that Social Capital is an important factor for increasing the level of SWB. For the trust dimension of social capital you may use the variable asking whether people can generally be trusted or not, for the weak ties dimension you could use the sum of the variables asking whether one is a member of ...

For the following section, we shall have a look at how the subjective well-being (SWB), namely general happiness and life satisfaction, are linked to Social Capital
In order to take a closer look at the SWB, we shall take the term of the Social Capital into account. The literature shows that Social Capital is an important factor for increasing the level of SWB. But first of all, what is Social Capital?
Social capital can be seen as "a positive product of human interaction" (investopedia.com). While it can not be owned by somebody, it is the result of connections between individuals within social networks. Social capital can be seen as a base pillar for the effective functioning of social groups. The absence of Social capital can mislead a group of people to not achieve a common goal or purpose. 
Despite its undeniable value for any group of individuals, there is no consensus on how social capital can be measured directly. This leads to the conclusion, that social capitalcan only be expressed through other indicators. The European Value Study (EVS) includes several indicators which can help to determine a countries Socal Capital 
In the following, we are going to consider trust as a key dimension for social capital. The EVS sees the trust variable as an indication whether most people can be trusted or not. in particular, the people participating in the survey get asked the following question: Generally speaking, would you say that most people can be trusted or that you can’t be too careful in dealing with people? 
The answer is then separated into two possible answers (1) "Most people can be trusted" and (2) "Can't be too careful". In the following diagram, we are going to provide an overview of the responses of the qualitative variable.


```{r , echo = FALSE, out.width="100%"}
trust_summary <- romania %>%
  
  group_by(trust_fac) %>%
  summarise(n = n()) %>%
  mutate(prop = round(n/sum(n)*100,2))

trust_plot <- trust_summary %>%
  
  ggplot(aes(x = "", y = prop, fill = trust_fac)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y", start = 0) +
  geom_text(aes(y = prop, label = n), color = "black", position = position_stack(vjust = 0.5)) +
  
  labs(title = "Dimensions of trust",
       fill = "Respones to the question") +
  
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    panel.background = element_rect(fill = "white"),
    panel.grid.major.y = element_line(colour = "white"),
    plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5)
    )

grid.arrange(trust_plot, tableGrob(trust_summary),  heights = c(2, 0.5))
```
As we can see from the pie chart and the table, people in Romania are generally rather careful. The vast majority (approx. 85%) expresses their trust in people on a level of "can't be too careful. This rough overview already gives the impression, that the level of Social Capital is rather low in Romania.
```{r , echo = FALSE, out.width="100%"}
bind_rows(trust_var_summary(happy_fac, "Happiness"),
          trust_var_summary(satisfaction_fac, "Satisfaction")) %>%

  ggplot(aes(x = as_factor(member), y = prop, fill = as_factor(trust_fac))) +
  geom_bar(stat = "identity") +
  labs(fill = "Level of trust",
       y = "Distribution (%)",
       title = "Impact of the level of trust on ...") + 
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle=90),
    #axis.title.y = element_blank(),
    panel.background = element_rect(fill = "white"),
    panel.grid.major.y = element_line(size = 0, linetype = 'solid',
                                      colour = "grey") ,
    plot.title = element_text(color="black", size= 12, face="bold.italic", vjust = 0.5) 
    
  ) +
  
  scale_y_continuous(labels = scales::percent,
                     breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) +
  
  facet_grid( ~ cat, scales="free_x") 
```
MUSS NOCH INTERPRETIERT WERDEN

Besides the trust factor, analyzing "weak ties" can also help to get an impression of the Social Capital among the Romanian people. The term weak ties implies connections among individuals which one does not know very well, but by whom one is surrounded on a regular basis. In the EVS, the interviewers asked the participants weather they are a member of various groups. Let us therefor first have a very general overview of how the membership in any group can have on happiness and or life satisfaction. 
Note: for a better overview, the level of satisfaction has been grouped into 1: 'Not satisfied at all', 2-5: 'Not very satisfied', 6-9: 'Quiet satisfied', 10: 'Very satisfied'.

member_happy <- ties_var_summary(happy_fac, "Happiness") +
  labs(title = "Level of happiness for (non) members",
       fill = "Level of happiness",
       subtitle = "of any group")
  
member_satisfaction <- ties_var_summary(satisfaction_group, "Satisfaction") +
  labs(title = "Level of satisfaction for (non) members",
       fill = "Level of satisfaction",
       subtitle = "of any group")

grid.arrange(member_happy, member_satisfaction, nrow = 1)

```{r , echo = FALSE, out.width="100%"}
bind_rows( fun_happy(happy, member_activity, "an activity"),
           fun_happy(happy, member_religion, "a religion"),
           fun_happy(happy, member_selfhelp, "a selfhelp group"),
           fun_happy(happy, member_charity, "a charity"),
           fun_happy(happy, member_labor_union, "a labor union"),
           fun_happy(happy, member_sports, "a sports group")) %>%
  
  group_by(member, cat, happy) %>%
  summarise(n = n()) %>%
  mutate(perc = n/sum(n)) %>%
  
  ggplot(aes(x = as_factor(member), y = perc, fill = as_factor(happy))) +
  geom_bar(stat = "identity") +
  labs(fill = "Level of Happiness",
       y = "Distribution (%)",
       title = "Lebel of happiness, given somebody is a member of ...") +
  
  scale_y_continuous(labels = scales::percent,
                     breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) +
  
  facet_grid( ~ cat) +
  
  theme_cat
```
It can be seen, that on average members of any given organisation or institution are happier and more satisfied, than individuals who are not.
BITTE NOCH WEITER INTERPRETIEREN

We assume that weak ties also appear in the neighborhood. Since neighbors are in some way silent, but steady companions, we find it highly important to look at what impact a certain neighborhood can have on the the trust the questioned people have in them.
```{r , echo = FALSE, out.width="100%"}
bind_rows( fun_happy(trust_neighbor, neighbours_diffrace, "have a different race"),
           fun_happy(trust_neighbor, neighbours_drinkers, "are drinkers"),
           fun_happy(trust_neighbor, neighbours_immig, "are immigrants"),
           fun_happy(trust_neighbor, neighbours_drugs, "are drugaddicts"),
           fun_happy(trust_neighbor, neighbours_homosex, "are homosexuals")) %>%
  
  group_by(member, cat, trust_neighbor) %>%
  summarise(n = n()) %>%
  mutate(perc = n/sum(n)) %>%
  
  ggplot(aes(x = as_factor(member), y = perc, fill = as_factor(trust_neighbor))) +
  geom_bar(stat = "identity") +
  labs(fill = "Level of trust in neighbours",
       y = "Distribution (%)",
       title = "Level of trust in neighbours, given they ...") +
  
  scale_y_continuous(labels = scales::percent,
                     breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)) +
  
  facet_grid( ~ cat) +
  
  theme_cat
```
Kann auch interpretiert werden

Furthermore, weak ties also appear within a religion. Individuals which share similar interests, such as the same god, implicitly see each other on a regular basis when attending a church service. The following two mosaic plots shall provide an overview on how the attendance of a church service might affect the level of SWB, as we assume, that weak ties have a positive effect on the Social capital and therefor on the level of SWB.
```{r , echo = FALSE, out.width="100%"}
service_happy <-  romania %>%
  ggplot() +
  geom_mosaic(aes(x =  product(happy_fac, relig_service_fac), fill = happy_fac)) +
  labs(title ="Comparison of happiness in life and church service attendance",
       fill = "Scale of happiness") +
  mosaic_theme

service_satis <- romania %>%
  ggplot() +
  geom_mosaic(aes(x =  product(satisfaction_group, relig_service_fac), fill = satisfaction_group)) +
  
  labs(title ="Comparison of satisfaction and church service attendance",
       fill = "Scale of satisfaction") +
  mosaic_theme

grid.arrange(service_happy, service_satis, nrow = 1)
```
Kann auch interpretiert werden.
